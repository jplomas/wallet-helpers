{"version":3,"sources":["../src/index.js"],"names":["sha256","require","Array","prototype","equals","array","strict","arguments","length","i","sort","hexToBytes","hex","bytes","c","push","parseInt","substr","bytesToHex","toString","join","hashPKandformat","ePK","h","doConvert","a","qx","qm","slice","isArrayOfInts","arr","result","forEach","element","checkWeightsAndThreshold","threshold","error","sum","reduce","accumulator","currentValue","getWalletFileType","wallet","webWallet","pythonNode","convertedWebWallet","Object","keys","isWalletFileDeprecated","encrypted","addressB32","pk","pythonNodeToWebWallet","output","addresses","e","module","exports","version","QRLAddressFromEPKHex","undefined","Error"],"mappings":"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","sourcesContent":["var sha256 = require('js-sha256')\n\nArray.prototype.equals = function(array, strict) {\n  if (!array)\n    return false\n\n  if (arguments.length == 1)\n    strict = true\n\n  if (this.length != array.length)\n    return false\n\n  for (var i = 0; i < this.length; i++) {\n    if (this[i] instanceof Array && array[i] instanceof Array) {\n      if (!this[i].equals(array[i], strict))\n        return false\n    } else if (strict && this[i] != array[i]) {\n      return false\n    } else if (!strict) {\n      return this.sort().equals(array.sort(), true)\n    }\n  }\n  return true\n}\n\nfunction hexToBytes(hex) {\n  for (var bytes = [], c = 0; c < hex.length; c += 2)\n    bytes.push(parseInt(hex.substr(c, 2), 16))\n  return bytes\n}\n\nfunction bytesToHex(bytes) {\n  for (var hex = [], i = 0; i < bytes.length; i++) {\n    hex.push((bytes[i] >>> 4).toString(16))\n    hex.push((bytes[i] & 0xf).toString(16))\n  }\n  return hex.join('')\n}\n\nfunction hashPKandformat(ePK) {\n  var h = hexToBytes(ePK)\n  return sha256(h)\n}\n\nfunction doConvert(ePK) {\n  var a = hashPKandformat(ePK)\n  var qx = sha256(hexToBytes('000400' + a))\n  var qm = qx.slice(56, 64)\n  return 'Q' + bytesToHex([0, 4, 0]) + a + qm\n}\n\nfunction isArrayOfInts(arr) {\n  var result = 0\n  arr.forEach(function(element) {\n    if (element === parseInt(element, 10)) {\n      result += 1\n    }\n  })\n  if (result === arr.length) {\n    return true\n  }\n  return false\n}\n\nfunction checkWeightsAndThreshold(arr, threshold) {\n  // check length > 0\n  if (arr.length === 0) {\n    return {\n      result: false,\n      error: 'Array has length 0'\n    }\n  }\n  // check each element in array, then threshold, is an integer\n  if (!isArrayOfInts(arr)) {\n    return {\n      result: false,\n      error: 'Array has non-integer values'\n    }\n  }\n  if (threshold !== parseInt(threshold, 10)) {\n    return {\n      result: false,\n      error: 'Threshold is not an integer'\n    }\n  }\n  // check threshold can actually be reacher\n  var sum = arr.reduce(function(accumulator, currentValue) {\n    return accumulator + currentValue\n  })\n  if (threshold > sum) {\n    return {\n      result: false,\n      error: 'Threshold can never be reached with these weights'\n    }\n  }\n  return {\n    result: true\n  }\n}\n\nfunction getWalletFileType(wallet) {\n  // determines source of wallet file\n  const webWallet = ['address', 'addressB32', 'pk', 'hexseed', 'mnemonic', 'height', 'hashFunction', 'signatureType', 'index', 'encrypted']\n  const pythonNode = ['addresses', 'encrypted', 'version']\n  const convertedWebWallet = ['pk', 'hexseed', 'mnemonic', 'height', 'hashFunction', 'signatureType', 'index', 'address', 'encrypted']\n  if (pythonNode.equals(Object.keys(wallet), false)) {\n    return 'PYTHON-NODE'\n  }\n  if (webWallet.equals(Object.keys(wallet[0]), false)) {\n    return 'WEB-WALLET'\n  }\n  if (convertedWebWallet.equals(Object.keys(wallet[0]), false)) {\n    return 'CONVERTED-WEB-WALLET'\n  }\n  return 'UNKNOWN'\n}\n\nfunction isWalletFileDeprecated(wallet) {\n  if (getWalletFileType(wallet) === 'PYTHON-NODE') return true\n  // There are three characteristics that describe a deprecated encrypted wallet file\n  // 1: The encrypted field is true and\n  // 2: The addressB32 field is unencrypted and\n  // 3: The pk field is unencrypted.\n  // Whilst neither of these fields risk funds being lost, they do reveal a users public\n  // address if their wallet file is stolen. This is a privacy concern.\n  // We can determine if they are unencrypted by checking their lengths.\n  // If addressB32 field is 64 characters in length, and pk field is 134 characters in length.\n  if (\n    (typeof wallet[0].encrypted !== 'undefined') &&\n    (typeof wallet[0].addressB32 !== 'undefined') &&\n    (typeof wallet[0].pk !== 'undefined')) {\n    if (\n      (wallet[0].encrypted === true) &&\n      (wallet[0].addressB32.length === 64) &&\n      (wallet[0].pk.length === 134)) {\n      return true\n    }\n  }\n  return false\n}\n\n\nfunction pythonNodeToWebWallet(wallet) {\n  const output = []\n  wallet.addresses.forEach(element => {\n    const e = element\n    e.encrypted = wallet.encrypted\n    output.push(e)\n  })\n  return output\n}\n\nmodule.exports = {\n  /**\n   * Reports the current module version\n   * @return {string} version\n   */\n  version: function() {\n    return '2.1.0'\n  },\n  QRLAddressFromEPKHex: function(ePK) {\n    if (ePK === undefined) {\n      throw new Error('No ePK parameter')\n    }\n    if (ePK.length !== 134) {\n      throw new Error('ePK length invalid')\n    }\n    return doConvert(ePK)\n  },\n  checkWeightsAndThreshold: function(arr, threshold) {\n    if (arr === undefined || threshold === undefined) {\n      throw new Error('Missing parameter')\n    }\n    return checkWeightsAndThreshold(arr, threshold)\n  },\n  isWalletFileDeprecated: function(wallet) {\n    if (wallet === undefined) {\n      throw new Error('Missing parameter')\n    }\n    return isWalletFileDeprecated(wallet)\n  },\n  getWalletFileType: function(wallet) {\n    if (wallet === undefined) {\n      throw new Error('Missing parameter')\n    }\n    return getWalletFileType(wallet)\n  },\n  pythonNodeToWebWallet: function(wallet) {\n    if (wallet === undefined) {\n      throw new Error('Missing parameter')\n    }\n    return pythonNodeToWebWallet(wallet)\n  },\n}\n"],"file":"index.js"}